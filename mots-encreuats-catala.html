<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8" />
  <title>Mini-Joc de Mots Encreuats ðŸ§ </title>
  <style>
  /* â”€â”€ Base: cos i capÃ§aleres â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  body {
    font-family: Arial, sans-serif;
    background-color: #f7fae6;
    text-align: center;
    padding: 20px;
  }
  h1 {
    color: #333;
  }

  /* â”€â”€ BotÃ³ principal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #boto {
    padding: 10px 20px;
    font-size: 18px;
    background-color: #2b8be1;
    color: #fff;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    margin-bottom: 20px;
  }
  #boto:hover {
    background-color: #1c6fb8;
  }

  /* â”€â”€ Contenidor de joc: graella + definicions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #joc {
    display: flex;
    align-items: flex-start;
    justify-content: center;
    gap: 20px;
    margin-top: 20px;
  }

  /* â”€â”€ Graella de paraules â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #graella {
    display: grid;
    gap: 2px;
    justify-content: center;
    margin-bottom: 30px;
    flex: 1 1 auto;
    max-width: 600px;
  }

  /* â”€â”€ Definicions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #definicions {
    text-align: left;
    font-size: 22px;
    flex: 0 0 450px;
    max-width: 450px;
  }

  /* â”€â”€ Missatge final â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #missatge-final {
    font-size: 22px;
    color: #009933;
    margin-top: 20px;
    font-weight: bold;
  }

  /* â”€â”€ CelÂ·les de la graella â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .casella {
    width: 30px;
    height: 30px;
    background-color: white;
    border: 1px solid #999;
    position: relative;
  }
  .casella.gris {
    background-color: grey;
  }

  /* â”€â”€ Inputs dins les celÂ·les â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .casella input {
    width: 100%;
    height: 100%;
    border: none;
    background: transparent;
    text-transform: uppercase;
    text-align: center;
    font-size: 18px;
    outline: none;
    color: black;      /* color per defecte */
    font-weight: normal;
  }

  /* â”€â”€ Estat focus â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .casella input:focus {
    background-color: #ddf7ff;
  }

  /* â”€â”€ Paraula completament correcta â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  /* nomÃ©s en aquest estat pintem de verd */
  input.correcte {
    color: green !important;
    font-weight: bold;
  }

  /* â”€â”€ BotÃ³ de pista â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .pista-btn {
    margin-left: 8px;
    padding: 2px 6px;
    font-size: 14px;
    cursor: pointer;
  }

  /* â”€â”€ Responsive: definicions sota graella en pantalles petites â”€â”€â”€â”€â”€ */
  @media (max-width: 768px) {
    #joc {
      flex-direction: column;
      align-items: center;
    }
    #definicions {
      margin-top: 20px;
      flex: none;
      width: 100%;
      max-width: none;
    }
  }
/* Container per a les peces de confeti */
#confetti-container {
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  pointer-events: none;
  overflow: hidden;
  z-index: 9999;
}

.confetti-piece {
  position: absolute;
  top: -10px;
  width: 6px; height: 6px;
  transform-origin: center;
  animation: confetti-fall linear 1, confetti-rotate linear 1;
}

@keyframes confetti-fall {
  to { transform: translateY(110vh); opacity: 0; }
}
@keyframes confetti-rotate {
  to { transform: rotateZ(360deg); }
}
</style>


</head>
<body>
  <h1>Mini-Joc de Mots Encreuats ðŸ§ </h1>
  <button id="boto">Jugar</button>
  <div id="missatge-final"></div>
  <div id="joc">
    <div id="graella"></div>
    <div id="definicions"></div>
  </div>
<div id="confetti-container"></div>

<script>
  // === CONFIGURACIÃ“ ===
  const GRID_SIZE         = 20;
  const NUM_WORDS         = 10;
  const MIN_TOTAL_CROSSES = 3;

  const DICCIONARI = {
      "GAT":    "ðŸ˜º Animal domÃ¨stic que fa miau",
      "GOS":    "ðŸ¶ Animal domÃ¨stic que fa guau",
      "OS":     "ðŸ» Animal gran que viu al bosc",
      "PEIX":   "ðŸ  Animal que viu a l'aigua",
      "GALL":   "ðŸ” Animal de granja que fa quiquiriquÃ­",
      "VACA":   "ðŸ„ Animal de granja que dona llet",
      "OVELLA": "ðŸ‘ Animal de granja amb llana",
      "PORC":   "ðŸ· Animal de granja que fa oinc",
      "RATA":   "ðŸ€ Animal petit amb cua llarga",
      "LLOP":   "ðŸº Animal salvatge que crida a la lluna",
      "OCELL":  "ðŸ•Šï¸ Animal que vola pel cel",
      "CONILL": "ðŸ‡ Animal amb orelles llargues",
      "CAVALL": "ðŸ´ Animal gran que galopa",
      "ZEBRA":  "ðŸ¦“ Animal amb ratlles negres i blanques",
      "LLEOÌ":  "ðŸ¦ Animal salvatge amb melena",
      "ELEFANT":"ðŸ˜ Animal molt gran amb trompa",
      "GIRAFA": "ðŸ¦’ Animal amb coll molt llarg",
      "DOFIÌ":  "ðŸ¬ Animal intelÂ·ligent que viu al mar",
      "SERP":   "ðŸ Animal llarg que repta",
      "GRANOTA":"ðŸ¸ Animal verd que salta i croa",
      "VERMELL":"ðŸŸ¥ Color del foc i de la sang",
      "BLAU":   "ðŸ”µ Color del cel i del mar",
      "VERD":   "ðŸŸ© Color de l'herba i les fulles",
      "GROC":   "ðŸŸ¨ Color del sol i dels pollastres",
      "ROSA":   "ðŸŒ¸ Color suau dels pÃ¨tals d'algunes flors",
      "NEGRE":  "âš« Color de la nit i del carbÃ³",
      "BLANC":  "âšª Color de la neu i dels nÃºvols",
      "TARONJA":"ðŸŠ Color de la fruita del mateix nom",
      "LILA":   "ðŸ’œ Color suau entre blau i rosa",
      "GRIS":   "ðŸŒ«ï¸ Color entre blanc i negre",
      "MARRO":  "ðŸŸ« Color de la terra i el fang",
      "VIOLETA":"ðŸ”® Color fosc entre blau i lila",
      "VERMELL":"ðŸ… Color intens com el tomÃ quet",
      "DAURAT": "ðŸ… Color brillant com l'or",
      "PLATEJAT":"ðŸ¥ˆ Color brillant com la plata",
      "CAP":    "ðŸ§  Part del cos on hi ha el cervell",
      "CARA":   "ðŸ™‚ Part del cos on hi ha els ulls i la boca",
      "ULLS":   "ðŸ‘€ Els usem per veure",
      "NAS":    "ðŸ‘ƒ El fem servir per olorar",
      "BOCA":   "ðŸ‘„ Hi posem el menjar",
      "DENTS":  "ðŸ¦· Les usem per mastegar",
      "MANS":   "ðŸ¤š Les usem per agafar coses",
      "PEUS":   "ðŸ¦¶ Els usem per caminar",
      "CAMES":  "ðŸ¦µ Uneixen els peus amb el cos",
      "BRAÃ‡OS": "ðŸ’ª Uneixen les mans amb el cos",
      "ORELLA": "ðŸ‘‚ La usem per sentir",
      "COLL":   "ðŸ¦´ Part que uneix el cap amb el cos",
      "ESQUENA":"ðŸ‹ï¸ Part del darrere del cos",
      "PANXA":  "ðŸ¤° Part del cos on hi ha l'estÃ³mac",
      "GENOLL": "ðŸ¤¸ ArticulaciÃ³ del mig de la cama",
      "CELLA":  "ðŸ˜Œ Pels que tenim sobre els ulls",
      "BARBA":  "ðŸ§” Pels que creixen a la cara",
      "CABELLS":"ðŸ’‡ Pels que tenim al cap",
      "FRONT":  "ðŸ’­ Part alta de la cara",
      "GALTES": "ðŸ˜Š Parts laterals de la cara",
      "MARE":   "ðŸ‘© Dona que tÃ© fills",
      "PARE":   "ðŸ‘¨ Home que tÃ© fills",
      "FILL":   "ðŸ‘¦ Nen respecte als seus pares",
      "FILLA":  "ðŸ‘§ Nena respecte als seus pares",
      "AVI":    "ðŸ‘´ Pare del pare o la mare",
      "AVIA":   "ðŸ‘µ Mare del pare o la mare",
      "GERMA":  "ðŸ‘¬ Nen que tÃ© els mateixos pares",
      "GERMANA":"ðŸ‘­ Nena que tÃ© els mateixos pares",
      "TIA":    "ðŸ‘±â€â™€ï¸ Germana del pare o la mare",
      "ONCLE":  "ðŸ‘±â€â™‚ï¸ GermÃ  del pare o la mare",
      "POMA":   "ðŸŽ Fruita vermella o verda que creix als arbres",
      "PLÃ€TAN": "ðŸŒ Fruita groga i allargada",
      "MANDARINA":"ðŸŠ Fruita petita, rodona i taronja",
      "LLIMONA":"ðŸ‹ Fruita groga i Ã cida",
      "MADUIXA":"ðŸ“ Fruita petita i vermella",
      "CIRERES":"ðŸ’ Fruites petites i vermelles amb pinyol",
      "RAIM":   "ðŸ‡ Fruita dolÃ§a que creix a les vinyes",
      "PERA":   "ðŸ Fruita verda amb forma allargada",
      "PRUNA":  "ðŸ‘ Fruita morada amb pinyol",
      "PINYA":  "ðŸ Fruita tropical amb fulles al damunt",
      "MELO":   "ðŸˆ Fruita gran i verda per fora",
      "SINDRIA":"ðŸ‰ Fruita gran i verda amb interior roig i moltes llavors",
      "KIWI":   "ðŸ¥ Fruita petita i peluda, marronosa per fora i verda pel dins",
      "MANGO":  "ðŸ¥­ Fruita tropical de color groc ataronjat, amb un gran pinyol",
      "AMETLLA":"ðŸŒ° Fruita seca blanca per dins i amb una pell marrÃ³",
      "AVELLANA":"ðŸŒ° Fruita seca dura, petita i arrodonida que es fa servir a per fer crema de cacao",
      "CASTANYA":"ðŸŒ° Fruita seca que es menja a la tardor",
      "NOUS":   "ðŸŒ° Fruit sec amb closca dura i forma de cervell",
      "PA":     "ðŸž Aliment fet amb farina i aigua",
      "LLET":   "ðŸ¥› Beguda blanca que donen les vaques",
      "OU":     "ðŸ¥š El posen les gallines",
      "CARN":   "ðŸ¥© Aliment que provÃ© dels animals",
      "FORMATGE":"ðŸ§€ Aliment fet amb llet",
      "IOGURT": "ðŸ¥› Aliment que es fa amb llet fermentada, cremÃ³s i una mica Ã cid",
      "PIZZA":  "ðŸ• Massa rodona amb tomÃ quet i formatge que es cuina al forn",
      "PASTA":  "ðŸ Aliment italiÃ  fet amb farina que s'ha de bullir abans de menjar",
      "ARROS":  "ðŸš Gra petit i blanc que es cou",
      "SOPA":   "ðŸœ Menjar lÃ­quid que es pren calent",
      "GALETES":"ðŸª DolÃ§os petits, plans, rodons i cruixents",
      "XOCOLATA":"ðŸ« El que mÃ©s m'agrada per verenar Ã©s pa amb .... sense pa ðŸŽµ",
      "MEL":    "ðŸ¯ DolÃ§ que fan les abelles",
      "SUCRE":  "ðŸ§‚ Pols blanca que endolceix",
      "VORERA":"ðŸ›£ï¸ Part del carrer per on caminen les persones",
      "CARRER":"ðŸ›£ï¸ Via per on circulen els cotxes",
      "COTXE":  "ðŸš— Vehicle amb quatre rodes",
      "CIUTAT": "ðŸ™ï¸ Lloc gran on viu molta gent",
      "POBLE":  "ðŸ˜ï¸ Lloc petit on viu poca gent",
      "ESCOLA": "ðŸ« Lloc on van els nens a aprendre",
      "PARC":   "ðŸžï¸ Lloc amb tobogan per jugar i passejar",
      "BOTIGA": "ðŸª Lloc on es compren coses",
      "FARMACIA":"ðŸ¥ Lloc on es compren medicaments",
      "HOSPITAL":"ðŸ¨ Lloc on curen els malalts",
      "CINEMA": "ðŸŽ¬ Lloc on es veuen pelÂ·lÃ­cules",
      "PLATJA": "ðŸ–ï¸ Lloc amb sorra i mar",
      "MUNTANYA":"â›°ï¸ ElevaciÃ³ molt alta de terra",
      "PONT":   "ðŸŒ‰ ConstrucciÃ³ per creuar rius",
      "ESTACIO":"ðŸš‰ Lloc on paren els trens",
      "AUTOBUS":"ðŸšŒ Vehicle gran i llargat per a moltes persones",
      "BICICLETA":"ðŸš² Vehicle de dues rodes que es pedala",
      "SEMÃ€FOR":"ðŸš¦ Llums que regulen el trÃ nsit",
      "BANC":   "ðŸ¦ Lloc on es guarden els diners",
      "MERCAT": "ðŸ›’ Lloc on es venen aliments",
      "FORN":   "ðŸž Lloc on es fa el pa",
      "CARNISSERIA":"ðŸ¥© Lloc on es ven carn",
      "BIBLIOTECA":"ðŸ“š Lloc ple de llibres",
      "MUSEU":  "ðŸ–¼ï¸ Lloc on es mostren obres d'art",
      "RESTAURANT":"ðŸ½ï¸ Lloc on es menja fora de casa",
      "CAFETERIA":"â˜• Lloc on es pren cafÃ¨",
      "CASA":   "ðŸ  Lloc on vivim",
      "PORTA":  "ðŸšª S'obre i es tanca per entrar",
      "FINESTRA":"ðŸªŸ S'obre per veure fora",
      "TAULA":  "ðŸ“ Moble pla per menjar",
      "CADIRA": "ðŸ’º Moble per seure",
      "LLIT":   "ðŸ›ï¸ Moble per dormir",
      "SOFÃ€":   "ðŸ›‹ï¸ Moble gran i acolxat per seure",
      "CUINA":  "ðŸ³ HabitaciÃ³ per cuinar",
      "BANY":   "ðŸš¿ HabitaciÃ³ per rentar-se",
      "JARDÃ":  "ðŸŒ³ Espai verd al voltant d'una casa",
      "PILOTA": "âš½ Objecte rodÃ³ per jugar",
      "JOGUINA":"ðŸ§¸ Objecte per jugar",
      "LLIBRE": "ðŸ“– Objecte de paper per llegir",
      "LLAPIS": "âœï¸ Objecte per escriure al que se li pot fer punta",
      "TELÃˆFON":"ðŸ“± Objecte per parlar amb gent",
      "RELLOTGE":"â° Objecte que marca l'hora",
      "MIRALL": "ðŸªž Objecte on es veu la imatge reflectida",
      "ESCALA": "ðŸªœ Serveix per pujar i baixar d'un pis a l'altre",
      "BALCÃ“":  "ðŸ¡ Espai obert a l'exterior d'una casa",
      "PATI":   "ðŸ–ï¸ Espai gran obert fora d'una casa perÃ² que forma part de la casa",
      "SOL":    "ðŸŒž Estrella que ilÂ·lumina el dia",
      "LLUNA":  "ðŸŒœ SatÃ¨lÂ·lit que es veu a la nit",
      "ESTRELLA":"â­ Punt de llum al cel nocturn",
      "NUVOL":  "â˜ï¸ Massa blanca que vola pel cel i fa ploure",
      "PLUJA":  "ðŸŒ§ï¸ Aigua que cau del cel",
      "VENT":   "ðŸŒ¬ï¸ Aire que es mou",
      "ARBRE":  "ðŸŒ² Planta alta amb tronc",
      "FLOR":   "ðŸŒ¸ Part colorida de les plantes",
      "HERBA":  "ðŸŒ¿ Planta petita i verda",
      "FULLA":  "ðŸƒ Part verda dels arbres",
      "BRANCA": "ðŸŒ´ Part de l'arbre que surt del tronc",
      "TERRA":  "ðŸŒŽ Planeta on vivim",
      "PEDRA":  "ðŸª¨ Material dur del sol",
      "AIGUA":  "ðŸ’§ LÃ­quid transparent que bevem",
      "FOC":    "ðŸ”¥ Flama que crema i fa calor",
      "CORRER": "ðŸƒ AvanÃ§ar molt de pressa",
      "SALTAR": "ðŸ¤¸ Aixecar-se de terra amb els peus",
      "JUGAR":  "ðŸŽ² Fer activitats divertides amb joguines o amics",
      "MENJAR": "ðŸ´ Posar aliments a la boca i mastegar-los",
      "DORMIR": "ðŸ˜´ Descansar amb els ulls tancats",
      "CAMINAR":"ðŸš¶ Moure's amb els peus",
      "PARLAR": "ðŸ—£ï¸ Dir paraules amb la boca",
      "ESCOLTAR":"ðŸ‘‚ Usar les orelles per sentir",
      "MIRAR":  "ðŸ‘€ Usar els ulls per veure",
      "RIURE":  "ðŸ˜‚ Fer soroll quan alguna cosa fa grÃ cia",
      "DIA":    "ðŸŒž Quan hi ha llum del sol",
      "NIT":    "ðŸŒœ Quan estÃ  fosc i es veu la lluna",
      "MATÃ":   "ðŸŒ… Primera part del dia",
      "TARDA":  "ðŸŒ‡ Part del dia desprÃ©s de dinar",
      "HIVERN": "â„ï¸ EstaciÃ³ mÃ©s freda de l'any",
      "PRIMAVERA":"ðŸŒ¸ EstaciÃ³ quan surten les flors",
      "ESTIU":  "â˜€ï¸ EstaciÃ³ mÃ©s calenta de l'any",
      "TARDOR": "ðŸ‚ EstaciÃ³ quan cauen les fulles",
      "FRED":   "ðŸ§Š SensaciÃ³ de baixa temperatura",
      "CALOR":  "ðŸ”¥ SensaciÃ³ de temperatura alta",
      "AVUI":   "ðŸ“† Aquest dia",
      "AHIR":   "â®ï¸ El dia anterior",
      "DEMÃ€":   "â­ï¸ El dia segÃ¼ent",
      "SETMANA":"ðŸ“… Set dies seguits",
      "MES":    "ðŸ—“ï¸ Quatre setmanes seguÃ¯des"
    };


  // === HELPERS ===
  function shuffle(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  function stripAccents(str) {
    return str.normalize('NFD')
              .replace(/[\u0300-\u036f]/g, '')
              .toUpperCase();
  }

  // === ESTAT GLOBAL ===
  let grid, gridRows, gridCols;
  let paraules = [];

  // === ARRANCA ===
  document.getElementById("boto").addEventListener("click", iniciarJoc);
  document.addEventListener("DOMContentLoaded", iniciarJoc);

  function iniciarJoc() {
  // netegem la UI
  document.getElementById("graella").innerHTML     = "";
  document.getElementById("definicions").innerHTML = "";
  document.getElementById("missatge-final").innerText = "";

  // tria paraules i inicialitza graella
  paraules = triaParaules();
  initGrid();

  // colÂ·loca la primera al centre
  posaPrimera(paraules[0]);

  // colÂ·loca la resta buscant creuaments
  let totalCrosses = 0;
  for (let i = 1; i < paraules.length; i++) {
    totalCrosses += posaAmbCreu(paraules[i]);
  }
  console.log("Creuaments totals:", totalCrosses);

  // ajusta lÃ­mits, renderitza i mostra definicions
  ajustaGrid();
  renderitzaGrid();
  mostraDefinicions();
}

  function triaParaules() {
  // 1) Pilla NUM_WORDS entrades aleatÃ²ries
  const entries = shuffle(Object.entries(DICCIONARI)).slice(0, NUM_WORDS);

  // 2) Map a objectes i ordena per longitud descendent
  const words = entries
    .map(([text, def]) => ({
      text,
      def,
      dir: Math.random() < 0.5 ? "h" : "v",
      row: 0,
      col: 0,
      cells: [],
      filled: false
    }))
    .sort((a, b) => b.text.length - a.text.length);

  // 3) Assigna el nÃºmero de pista segons lâ€™ordre final
  return words.map((w, i) => ({ ...w, numero: i + 1 }));
}


  function initGrid() {
    grid = Array.from({ length: GRID_SIZE }, () =>
      Array.from({ length: GRID_SIZE }, () => ({
        char: null, black: true, number: null
      }))
    );
    gridRows = gridCols = GRID_SIZE;
  }

  function posaPrimera(w) {
    const L = w.text.length;
    if (w.dir === "h") {
      w.row = Math.floor(GRID_SIZE / 2);
      w.col = Math.floor((GRID_SIZE - L) / 2);
    } else {
      w.col = Math.floor(GRID_SIZE / 2);
      w.row = Math.floor((GRID_SIZE - L) / 2);
    }
    escriuParaula(w);
  }

  function posaAmbCreu(w) {
  const L = w.text.length;
  const candidats = [];

  // 1) cerquem punts de creuament
  paraules.forEach(pw => {
    if (pw === w || !pw.cells.length) return;
    pw.text.split("").forEach((chPw, iPw) => {
      w.text.split("").forEach((chW, iW) => {
        if (chPw === chW) {
          const r0 = pw.row + (pw.dir==="v"?iPw:0) - (w.dir==="v"?iW:0);
          const c0 = pw.col + (pw.dir==="h"?iPw:0) - (w.dir==="h"?iW:0);
          if (potColocar(w, r0, c0)) {
            candidats.push({ r0, c0 });
          }
        }
      });
    });
  });

  // si hi ha candidats, en deixem un aleatori
  shuffle(candidats);
  if (candidats.length) {
    escriuParaula(w, candidats[0].r0, candidats[0].c0);
    return 1;
  }

  // 2) fallback purament aleatori: L*10 intents
  let tries = 0;
  while (tries++ < L * 3) {
    const r0 = Math.floor(Math.random() * (GRID_SIZE - (w.dir==="v"?L:1)));
    const c0 = Math.floor(Math.random() * (GRID_SIZE - (w.dir==="h"?L:1)));
    if (potColocar(w, r0, c0)) {
      escriuParaula(w, r0, c0);
      return 0;
    }
  }

  // si no hem colÂ·locat la paraula, tornem 0
  return 0;
}

  function potColocar(w, r0, c0) {
    const L = w.text.length;
    for (let k = 0; k < L; k++) {
      const r = r0 + (w.dir==="v"?k:0),
            c = c0 + (w.dir==="h"?k:0);
      if (r<0||c<0||r>=GRID_SIZE||c>=GRID_SIZE) return false;
      const cell = grid[r][c];
      if (!cell.black && cell.char !== w.text[k]) return false;
      if (k===0 && cell.number!=null) return false;
    }
    return true;
  }

  function escriuParaula(w, r0=w.row, c0=w.col) {
    w.row = r0; w.col = c0; w.cells = [];
    for (let k = 0; k < w.text.length; k++) {
      const r = r0 + (w.dir==="v"?k:0),
            c = c0 + (w.dir==="h"?k:0);
      grid[r][c] = {
        char: w.text[k],
        black: false,
        number: k===0 ? w.numero : grid[r][c]?.number
      };
      w.cells.push({r,c});
    }
  }

  function ajustaGrid() {
    let minR=GRID_SIZE, minC=GRID_SIZE, maxR=-1, maxC=-1;
    paraules.forEach(w => w.cells.forEach(({r,c}) => {
      minR=Math.min(minR,r); maxR=Math.max(maxR,r);
      minC=Math.min(minC,c); maxC=Math.max(maxC,c);
    }));
    if (maxR<minR||maxC<minC) { gridRows=gridCols=GRID_SIZE; return; }
    gridRows=maxR-minR+1; gridCols=maxC-minC+1;
    const newG = [];
    for (let r=minR; r<=maxR; r++) {
      const row=[];
      for (let c=minC; c<=maxC; c++){
        row.push({...grid[r][c]});
      }
      newG.push(row);
    }
    paraules.forEach(w => {
      w.cells = w.cells.map(({r,c}) => ({
        r: r-minR, c: c-minC
      }));
    });
    grid=newG;
  }

  function renderitzaGrid() {
    const cont = document.getElementById("graella");
    cont.style.gridTemplateColumns = `repeat(${gridCols},30px)`;
    cont.style.gridTemplateRows    = `repeat(${gridRows},30px)`;
    cont.innerHTML = "";
    for (let r=0; r<gridRows; r++){
      for (let c=0; c<gridCols; c++){
        const cel = document.createElement("div");
        cel.className = grid[r][c].black ? "casella gris" : "casella";
        if (!grid[r][c].black) {
          const inp = document.createElement("input");
          inp.maxLength = 1;
          inp.dataset.r = r;
          inp.dataset.c = c;
          inp.addEventListener("input", onInput);
          inp.addEventListener("keydown", gestorTecles);
          // marcador de nÃºmero
          if (grid[r][c].number) {
            const num = document.createElement("span");
            num.style.cssText = "position:absolute;top:2px;left:2px;font-size:10px";
            num.innerText = grid[r][c].number;
            cel.appendChild(num);
          }
          cel.appendChild(inp);
        }
        cont.appendChild(cel);
      }
    }
  }

  function mostraDefinicions() {
  const div = document.getElementById("definicions");
  div.innerHTML = "<h3>Definicions</h3>";

  paraules.forEach(w => {
    const linea = document.createElement("div");
    linea.innerText = `${w.numero}. ${w.def}`;

    const btn = document.createElement("button");
    btn.textContent    = "Pista";
    btn.className      = "pista-btn";
    btn.dataset.numero = w.numero;
    btn.addEventListener("click", demanaPista);

    linea.appendChild(btn);
    div.appendChild(linea);
  });
}


  // --- 1) demanaPista: escriu la pista i dispara validaciÃ³ directa
// â”€â”€ Demanar pista â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function demanaPista(ev) {
  // 1) Identifiquem el mot pel nÃºmero de pista
  const num = +ev.currentTarget.dataset.numero;
  const w   = paraules.find(x => x.numero === num);

  // 2) Cerquem les caselles encara buides
  const buides = w.cells.filter(({r, c}) => {
    const inp = document.querySelector(`input[data-r="${r}"][data-c="${c}"]`);
    return inp.value === "";
  });
  if (!buides.length) return;  // si ja estÃ  ple, no fem res

  // 3) Triem a lâ€™atzar una de les buides i hi posem la lletra correcta
  const { r, c } = buides[Math.floor(Math.random() * buides.length)];
  const idx      = w.cells.findIndex(cc => cc.r === r && cc.c === c);
  const inp      = document.querySelector(`input[data-r="${r}"][data-c="${c}"]`);
  inp.value = w.text[idx];

  // 4) DesprÃ©s dâ€™emplenar la casella, validem el mot per si ja es compleix
  validaParaula(w);
}



  function gestorTecles(ev) {
    const key = ev.key, r = +ev.target.dataset.r, c = +ev.target.dataset.c;
    let nr=r, nc=c;
    if (key==="ArrowUp")    nr--;
    if (key==="ArrowDown")  nr++;
    if (key==="ArrowLeft")  nc--;
    if (key==="ArrowRight") nc++;
    setTimeout(()=> {
      document.querySelector(`input[data-r="${nr}"][data-c="${nc}"]`)?.focus();
    }, 0);
  }

  // --- 2) onInput: mou focus i, si totes les caselles estan plenes, valida
function onInput(ev) {
  const inp = ev.target;
  const r   = +inp.dataset.r;
  const c   = +inp.dataset.c;

  // small delay perquÃ¨ el value ja s'hagi gravat
  setTimeout(() => {
    for (const w of paraules) {
      const idx = w.cells.findIndex(cc => cc.r === r && cc.c === c);
      if (idx === -1) continue;

      // 1) mouem focus si no Ã©s l'Ãºltima lletra
      if (idx < w.cells.length - 1) {
        const next = w.cells[idx + 1];
        document
          .querySelector(`input[data-r="${next.r}"][data-c="${next.c}"]`)
          ?.focus();
      }

      // 2) si totes les caselles estan plenes, validem el mot
      const totesPlenes = w.cells.every(({ r, c }) => {
        return document.querySelector(`input[data-r="${r}"][data-c="${c}"]`)
                      .value !== "";
      });
      if (totesPlenes) {
        validaParaula(w);
      }

      break;
    }
  }, 0);
}



  function validaParaula(w) {
  // 1) recollim i normalitzem l'entrada i la soluciÃ³
  const user = stripAccents(
    w.cells.map(({ r, c }) =>
      document.querySelector(`input[data-r="${r}"][data-c="${c}"]`).value
    ).join("")
  );
  const target = stripAccents(w.text);
  const ok = user === target;

  if (ok) {
    // mot correcte: pintem verd i comprovem final
    w.cells.forEach(({ r, c }) => {
      const inp = document.querySelector(`input[data-r="${r}"][data-c="${c}"]`);
      inp.classList.add("correcte");
      inp.onclick = null;        // desactivem lâ€™esborrat
    });
    w.filled = true;
    comprovaFinal();

  } else {
    // mot complet perÃ² incorrecte: per defecte ja no pintem vermell
    // assignem onclick per esborrar tot el mot
    w.cells.forEach(({ r, c }) => {
      const inp = document.querySelector(`input[data-r="${r}"][data-c="${c}"]`);
      inp.onclick = () => {
        // netegem totes les caselles del mot
        w.cells.forEach(({ r, c }) => {
          const i2 = document.querySelector(`input[data-r="${r}"][data-c="${c}"]`);
          i2.value = "";
          i2.classList.remove("correcte");
          i2.onclick = null;
        });
        // focus a la primera casella
        const first = w.cells[0];
        document.querySelector(
          `input[data-r="${first.r}"][data-c="${first.c}"]`
        )?.focus();
      };
    });
  }
}


function comprovaFinal() {
  if (paraules.every(w => w.filled)) {
    console.log("ðŸŽ‰ Has acabat, llancem confeti");  // <-- DEBUG
    document.getElementById("missatge-final").innerText =
      "ðŸŽ‰ FantÃ stic! Has resolt tots els mots encreuats!";
    launchConfetti();
  }
}

// Generador de confeti
function launchConfetti() {
  const container = document.getElementById("confetti-container");
  console.log("âš¡ confeti container:", container);    // <-- DEBUG

  const colors = ["#f94144","#f3722c","#f9c74f","#90be6d","#577590"];
  const count  = 80;

  for (let i = 0; i < count; i++) {
    const el = document.createElement("div");
    el.className = "confetti-piece";
    el.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
    el.style.left  = Math.random() * 100 + "vw";
    el.style.opacity = Math.random() * 0.8 + 0.2;
    const delay    = Math.random() * 0.5;
    const duration = 2 + Math.random() * 1.5;
    el.style.animationDelay    = delay + "s";
    el.style.animationDuration = duration + "s";

    container.appendChild(el);
    setTimeout(() => el.remove(), (delay + duration) * 1000);
  }
}
</script>


</body>
</html>